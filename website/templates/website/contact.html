{% extends "website/base.html" %}
{% load static %}

{% block title %}Contact Us - Webly{% endblock %}

{% block content %}

{% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}


<!-- HERO -->
<section class="hero section text-center">
  <div class="container">
    <h1>Let's Get in Touch</h1>
    <p>Have questions? Ready to grow your business? Drop us a line.</p>
  </div>
</section>

<!-- CONTACT -->
<section class="section">
  <div class="container">
    <div class="row g-4 align-items-start">

      <!-- Form -->
      <div class="col-md-7">
        <div class="rounded-xl shadow-1 bg-white" style="padding:48px;">
          <h2 class="mb-3" style="margin-top:0;">Your Info</h2>
          <form method="post" action="{% url 'website:contact' %}" id="contact-form">
  {% csrf_token %}
  <div class="mb-3">
    <label for="name" class="form-label">Name:</label>
    <input type="text" id="name" name="name" class="form-control" required>
  </div>

  <!-- Contact method toggle -->
  <div class="mb-2">
    <label class="form-label d-block">How should we contact you?</label>
    <div class="d-flex gap-3">
      <div class="form-check">
        <input class="form-check-input" type="radio" name="contact_method" id="method_email" value="email" checked>
        <label class="form-check-label" for="method_email">Email</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="contact_method" id="method_phone" value="phone">
        <label class="form-check-label" for="method_phone">Phone</label>
      </div>
    </div>
  </div>

  <!-- Email -->
  <div class="mb-3" id="email_group">
    <label for="email" class="form-label">Email:</label>
    <input type="email" id="email" name="email" class="form-control" autocomplete="email">
    <div class="form-text">We’ll use this method to reply.</div>
  </div>

  <!-- Phone -->
  <div class="mb-3 d-none" id="phone_group">
    <label for="phone" class="form-label">Phone:</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      class="form-control"
      inputmode="tel"
      pattern="^\+?1?[-.\s()]?\d{3}[-.\s()]?\d{3}[-.\s()]?\d{4}$"
      placeholder="(555) 123-4567"
    >
    <div class="form-text">We'll use this method to reply.</div>
  </div>

  <!-- Growth plan -->
  <div class="mb-3">
    <label class="form-label d-block">Preferred Growth Plan</label>
    <div class="rounded-xl border p-3">
      <div class="form-check mb-2">
        <input class="form-check-input" type="radio" name="growth_plan" id="plan_minimal" value="Minimal-Growth" required>
        <label class="form-check-label" for="plan_minimal">
          Minimal-Growth — $400/month
        </label>
      </div>
      <div class="form-check mb-2">
        <input class="form-check-input" type="radio" name="growth_plan" id="plan_standard" value="Standard-Growth">
        <label class="form-check-label" for="plan_standard">
          Standard-Growth — 
          <span class="text-muted text-decoration-line-through me-2">$550</span>
          $450/month
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="growth_plan" id="plan_explosive" value="Explosive-Growth">
        <label class="form-check-label" for="plan_explosive">
          Explosive-Growth — $900/month
        </label>
      </div>
    </div>
  </div>

  <button type="submit" class="btn-primary-soft d-inline-block">Send Info</button>
</form>

<script>
  (function () {
    const methodEmail = document.getElementById('method_email');
    const methodPhone = document.getElementById('method_phone');
    const emailGroup  = document.getElementById('email_group');
    const phoneGroup  = document.getElementById('phone_group');
    const emailInput  = document.getElementById('email');
    const phoneInput  = document.getElementById('phone');
    const form        = document.getElementById('contact-form');

    function updateVisibility() {
      const useEmail = methodEmail.checked;

      // Toggle groups
      emailGroup.classList.toggle('d-none', !useEmail);
      phoneGroup.classList.toggle('d-none', useEmail);

      // Toggle required attributes
      emailInput.required = useEmail;
      phoneInput.required = !useEmail;

      // Clear the inactive field so backend doesn't get both
      if (useEmail) { phoneInput.value = ''; }
      else { emailInput.value = ''; }
    }

    methodEmail.addEventListener('change', updateVisibility);
    methodPhone.addEventListener('change', updateVisibility);
    updateVisibility(); // initialize

    // Extra guard: prevent submit if neither field is filled
    form.addEventListener('submit', function (e) {
      const useEmail = methodEmail.checked;
      if (useEmail && !emailInput.value.trim()) {
        e.preventDefault();
        emailInput.focus();
      } else if (!useEmail && !phoneInput.value.trim()) {
        e.preventDefault();
        phoneInput.focus();
      }
    });
  })();
</script>

        </div>
      </div>

      <!-- Info -->
      <div class="col-md-5">
        <div class="rounded-xl shadow-1 bg-white contact-info" style="padding:48px;">
          <h2 class="mb-3" style="margin-top:0;">Contact Info</h2>
          <p><strong>Email:</strong> hello@weblylocal.com</p>
          <p><strong>Phone:</strong> (832)-942-8646</p>
          <p><strong>Hours:</strong> Mon–Fri, 9am–5pm CST</p>
          <img
            loading="lazy"
            src="{% static 'website/images/contact.png' %}"
            alt="Contact us"
            class="img-fluid rounded-xl shadow-1"
            style="margin-top:12px;"
          >
        </div>
      </div>

    </div>
  </div>
</section>

{% endblock %}
